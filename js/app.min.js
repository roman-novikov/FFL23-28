function testWebP(callback) {
	var webP = new Image();
	webP.onload = webP.onerror = function () {
		callback(webP.height == 2);
	};
	webP.src = "data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA";
}
testWebP(function (support) {
	if (support === true) {
		document.querySelector('html').classList.add('_webp');
	} else {
		document.querySelector('html').classList.add('_no-webp');
	}
});
//===== section help

let help = document.querySelector('.help');
if (help) {
	help.addEventListener('click', function(event) {
		let target = event.target;
		if (target.classList.contains('content-help__link')) {
			target.previousElementSibling.classList.toggle('_active');
			target.classList.toggle('_active');
			event.preventDefault();
		}
		if (target.classList.contains('help__more')) {
			if ( !target.classList.contains('_loading') ) {
				target.classList.add('_loading');
				getHelp(target);
			}
			event.preventDefault();
		}
	});
}

async function getHelp(target) {
	let response = await fetch('faq.html');
	if (response.ok) {
		let text = await response.text();
		let helpContent = document.querySelector('.help__content');
		if (helpContent) {
			helpContent.insertAdjacentHTML('beforeend', text);
		}
		target.classList.remove('_loading')
	} else {
		alert('Что-то пошло не так...');
	}
}

//========================================
'use strict';

//===== Перемещение HTML элементов по DOM дереву при адаптации сайта под размер окна браузера
// Для работы нужно задать HTML элементам, которые будут перемещаться по DOM дереву, data атрибут следующим обрабом:
// data-adaptive=".menu__body,768,last", где
// .menu__body - куда переместить HTML элемент с атрибутом data-adaptive
// 768 - разрешение экрана на котором будет перемещен HTML элемент
// last - позиция, куда будет вставлен HTML элемент. Могут быть заданы следующие значения:
// 	- last - элементбует будет помещен в конец .menu__body,
// 	- first - элементбует будет помещен в начало .menu__body.

// Функция возвращает объект adaptiveObject.
// В объекте содержится инфорация об элементах, которые необходимо перемещать по DOM дереву
function getAdaptiveObect() {
	let adaptiveElements = document.querySelectorAll('[data-adaptive]');
	let adaptiveObject = {
		'parent': [],
		'prev': [],
		'next': [],
		'where': [],
		'when': [],
		'position': [],
		'elements': adaptiveElements,
	};
	for (let i = 0; i < adaptiveElements.length; i++) {
		let arr = adaptiveElements[i].dataset.adaptive.split(',');
		adaptiveObject.where.push(arr[0]);
		adaptiveObject.when.push(arr[1]);
		adaptiveObject.position.push(arr[2]);
		adaptiveObject.parent.push(adaptiveElements[i].parentElement);
		adaptiveObject.prev.push(adaptiveElements[i].previousElementSibling);
		adaptiveObject.next.push(adaptiveElements[i].nextElementSibling);
	}
	return adaptiveObject;
}
let adaptiveObject = getAdaptiveObect();
// Перемещение HTML элементов по DOM дереву при изменении размера окна браузера
window.addEventListener('resize', function(event){
	let windWidth = document.documentElement.clientWidth;
	for (let i = 0; i < adaptiveObject.elements.length; i++) {
		if (windWidth <= adaptiveObject.when[i]) {
			if (adaptiveObject.position[i] === 'last') {
				document.querySelector(adaptiveObject.where[i]).append(adaptiveObject.elements[i])
			}
			if (adaptiveObject.position[i] === 'first') {
				document.querySelector(adaptiveObject.where[i]).prepend(adaptiveObject.elements[i])
			}
		} else {
			// if (adaptiveObject.elements[i].parentElement !== adaptiveObject.parent[i]) {
				if (adaptiveObject.prev[i]) {
					adaptiveObject.prev[i].after(adaptiveObject.elements[i]);
				} else if (adaptiveObject.next[i]) {
					adaptiveObject.next[i].before(adaptiveObject.elements[i]);
				} else {
					adaptiveObject.parent[i].append(adaptiveObject.elements[i]);
				}
			// }
		}
	}
});
let burger = document.querySelector('._burger-icon');
if (burger) {
	burger.addEventListener('click', function(event) {
		let menu = document.querySelector('.menu__body');
		let body = document.body;
		body.classList.toggle('_lock');
		burger.classList.toggle('_active');
		menu.classList.toggle('_active');
	});
}

//HTML структура для меню:
/* <div class="header__menu menu">
	<div class="menu__burger _burger-icon">
		<span></span>
	</div>
	<nav class="menu__body">
		<ul class="menu__list">
			<li><a href="#" class="menu__link">Home</a></li>
			<li><a href="#" class="menu__link">Workspace</a></li>
			<li><a href="#" class="menu__link">Service</a></li>
			<li><a href="#" class="menu__link">Events</a></li>
			<li><a href="#" class="menu__link">Reiews</a></li>
			<li><a href="#" class="menu__link">Contact Us</a></li>
		</ul>
	</nav>
</div> */
let header = document.querySelector('.header__conteiner');
window.addEventListener('scroll', function(event) {
	if(window.pageYOffset > 10) {
		header.classList.add('_scroll');
	} else {
		header.classList.remove('_scroll');
	}
});
new Swiper('.slider-introducing__body', {
	wrapperClass: 'slider-introducing__wrapper',
	slideClass: 'slider-introducing__item',
	observer: true,
	observeParents: true,
	slidesPerView: 1,
	spaceBetween: 0,
	speed: 800,
	loop: true,
	pagination: {
		el: '.slider-introducing__dotts',
		clickable: true,
	},
});

//----------------------------------------

let totalSlidesSpaces = document.querySelector('.slider-our-spaces__wrapper').children.length; //общее кол-во слайдов
let ourSpaces = new Swiper('.slider-our-spaces__body', {
	wrapperClass: 'slider-our-spaces__wrapper',
	slideClass: 'slider-our-spaces__item',
	observer: true,
	observeParents: true,
	slidesPerView: 3,
	spaceBetween: 30,
	speed: 800,
	loop: true,
	breakpoints: {
		// when window width is >= 320px
		320: {
			slidesPerView: 1,
			spaceBetween: 10
		},
		// when window width is >= 480px
		551: {
			slidesPerView: 2,
			spaceBetween: 30
		},
		// when window width is >= 640px
		993: {
			slidesPerView: 3,
			spaceBetween: 30
		}
	 },
	navigation: {
		nextEl: '.arrow-slider__next',
		prevEl: '.arrow-slider__prev'
	},
	pagination: {
		el: '.slider-our-spaces__pagination',
		type: 'progressbar',
		clickable: true,
	},
});

swiperFraction (ourSpaces, totalSlidesSpaces, 'slider-our-spaces');

//----------------------------------------

let facilitiesTabs = document.querySelector('.our-facilities__tabs');
let colectionFacilitiesTab = document.querySelectorAll('.our-facilities__tabs-item'); //колекция html элементов (табов для слайдеров Facilities)
let colectionFacilitiesSlider = document.querySelectorAll('.slider-our-facilities__body'); //колекция html элементов (всех слайдеров Facilities)
let currentFraction = document.querySelector('.our-facilities__fraction-current');
let totalFraction = document.querySelector('.our-facilities__fraction-total');
if (colectionFacilitiesSlider) {
	//запись количества слайдов в каждом слайдере Facilities
	colectionFacilitiesSlider.forEach((element) => {
		element.dataset.total = element.firstElementChild.children.length;
	});
	if (totalFraction) {
		totalFraction.innerHTML = (colectionFacilitiesSlider[0].dataset.total < 10) ? '0'+colectionFacilitiesSlider[0].dataset.total : colectionFacilitiesSlider[0].dataset.total;
	}
	//инициализация кадого слайдера из колекции, все слайдеры display: block; Это важно!
	//если слайдеры скрыты и выставлен параметр loop: true, то realIndex и progress будут
	//определяться не правильно при инициализации!
	colectionFacilitiesSlider.forEach((element) => {
		element = new Swiper('.slider-our-facilities__body', {
			wrapperClass: 'slider-our-facilities__wrapper',
			slideClass: 'slider-our-facilities__item',
			observer: true,
			observeParents: true,
			slidesPerView: 1,
			spaceBetween: 0,
			speed: 800,
			loop: true,
			pagination: {
				el: '.our-facilities__pagination',
				type: 'progressbar',
				clickable: true,
			},
			on: {
				slideChange: function() {
					this.el.dataset.activeIndex = ++this.realIndex;
					if (currentFraction) {
						currentFraction.innerHTML = (this.el.dataset.activeIndex < 10) ? '0'+this.el.dataset.activeIndex : this.el.dataset.activeIndex;
					}
				},
			},
		});
	});
	//скрываем все слайдеры
	colectionFacilitiesSlider.forEach((element) => {
		element.parentElement.classList.add('_hide');
	});
	//и показываем первый слайдер
	colectionFacilitiesSlider[0].parentElement.classList.remove('_hide');
	colectionFacilitiesSlider[0].parentElement.classList.add('_active');
}
//обработчик события 'click' на табах
if (facilitiesTabs) {
	facilitiesTabs.addEventListener('click', function(event) {
		let target = event.target;
		let dataIndex = target.dataset.index;
		let currentPagination = colectionFacilitiesSlider[dataIndex].dataset.activeIndex/colectionFacilitiesSlider[dataIndex].dataset.total;
		if (colectionFacilitiesTab) {
			colectionFacilitiesTab.forEach((element, index) => {
				element.classList.remove('_active');
				colectionFacilitiesSlider[index].parentElement.classList.remove('_active');
				colectionFacilitiesSlider[index].parentElement.classList.add('_hide');
			});
		}
		target.classList.add('_active');
		colectionFacilitiesSlider[dataIndex].parentElement.classList.remove('_hide');
		colectionFacilitiesSlider[dataIndex].parentElement.classList.add('_active');
		//отрисовка фракции
		if (totalFraction) {
			totalFraction.innerHTML = (colectionFacilitiesSlider[dataIndex].dataset.total < 10) ? '0'+colectionFacilitiesSlider[dataIndex].dataset.total : colectionFacilitiesSlider[dataIndex].dataset.total;
		}
		if (currentFraction) {
			currentFraction.innerHTML = (colectionFacilitiesSlider[dataIndex].dataset.activeIndex < 10) ? '0'+colectionFacilitiesSlider[dataIndex].dataset.activeIndex : colectionFacilitiesSlider[dataIndex].dataset.activeIndex;
		}
		//отрисовка пагинации прогрессбара
		colectionFacilitiesSlider[dataIndex].swiper.pagination.el.innerHTML = `<span class=\"swiper-pagination-progressbar-fill\" style=\"transform: translate3d(0px, 0px, 0px) scaleX(${currentPagination}) scaleY(1); transition-duration: 800ms;\"></span>`
	});
}

//----------------------------------------

	new Swiper('.slider-frispes__body', {
		wrapperClass: 'slider-frispes__wrapper',
		slideClass: 'slider-frispes__item',
		observer: true,
		observeParents: true,
		slidesPerView: 'auto',
		spaceBetween: 30,
		speed: 800,
		loop: true,
		navigation: {
			nextEl: '.arrow-slider__next',
			prevEl: '.arrow-slider__prev'
		},
	});

//----------------------------------------

new Swiper('.slider-reviews__body', {
	wrapperClass: 'slider-reviews__wrapper',
	slideClass: 'slider-reviews__slide',
	observer: true,
	observeParents: true,
	slidesPerView: 'auto',
	spaceBetween: 30,
	speed: 800,
	loop: true,
	navigation: {
		nextEl: '.arrow-slider__next',
		prevEl: '.arrow-slider__prev'
	},
	pagination: {
		el: '.slider-reviews__pagination',
		type: 'progressbar',
		clickable: true,
	},
});

//----------------------------------------

function swiperFraction (slider, totalSlides, classFraction) {
	let CurrentSlide = document.querySelector(`.${classFraction}__fraction-current`);
	let TotalSlides = document.querySelector(`.${classFraction}__fraction-total`);
	let indexCurrentActiveSlide = ++slider.realIndex; //индекс текущего активного слайда
	if (CurrentSlide) {
		CurrentSlide.innerHTML = (indexCurrentActiveSlide < 10) ? '0'+indexCurrentActiveSlide : indexCurrentActiveSlide;
	}
	if (TotalSlides) {
		TotalSlides.innerHTML = (totalSlides < 10) ? '0'+totalSlides : totalSlides;
	}
	slider.on('slideChange', function() {
	indexCurrentActiveSlide = ++slider.realIndex;
	CurrentSlide.innerHTML = (indexCurrentActiveSlide < 10) ? '0'+indexCurrentActiveSlide : indexCurrentActiveSlide;
});
}
'use strict';
//Динамически создаваемые элементы для замены элементов формы "SELECT"
//
//Все элементы "SELECT" в форме заменяются следующей структурой:
//<div class="select-div" data-select-id="#id">
//  "Текст элемента по умолчанию"
//  <ul class="select-ul">
//    <li class="select-li" data-value="n">...</li>
//    <li class="select-li" data-value="n">...</li>
//    ...
//    <li class="select-li" data-value="n">...</li>
//  </ul>
//</div>
//
// #id - id оригинального элемента "SELECT" из формы 
// n - значение атрибута value оригинального элемента "OPTION" из формы
//

function clickSelect(event) {
	let target = event.target;
	if (target.tagName === 'LI') { //'LI'
		let value = target.dataset.value;
		let parentUl = target.parentElement;
		let parentDiv = target.parentElement.parentElement;
		let linkedSelect = document.querySelector('#'+parentDiv.dataset.selectId);
		parentDiv.firstChild.textContent = target.textContent;
		linkedSelect.options.selectedIndex = value - 1;
		parentUl.classList.remove('_visible');
		parentDiv.classList.remove('_active');
	} else { //'DIV'
		target.children[0].classList.toggle('_visible');
		target.classList.toggle('_active');
		let otherActiveSelectDiv = document.querySelectorAll('.select-div._active');
		for (const div of otherActiveSelectDiv) {
			if (div.dataset.selectId !== target.dataset.selectId) {
				div.children[0].classList.remove('_visible');
				div.classList.remove('_active');
			}
		}
	}
}

document.addEventListener('click', closeAllActiveSelect);

function closeAllActiveSelect(event) {
	let target = event.target;
	let allActiveSelectDiv = document.querySelectorAll('.select-div._active');
	if (!target.classList.contains('select-div')) {
		for (const div of allActiveSelectDiv) {
			div.children[0].classList.remove('_visible');
			div.classList.remove('_active');
		}
	}
}

function createObjectSelects() {
	let objectSelects = {
		selectCollection: document.querySelectorAll('select'),
		parent: [],
		prep: [],
		next: [],
		arrayCreateSelect: [],
	}
	for (const select of objectSelects.selectCollection) {
		select.style.display = 'none';
		objectSelects.parent.push(select.parentElement);
		objectSelects.prep.push(select.previousElementSibling);
		objectSelects.next.push(select.nextElementSibling);
		let index = select.options.selectedIndex;
		let createDiv = document.createElement('div');
		createDiv.classList.add('select-div');
		createDiv.dataset.selectId = select.id;
		createDiv.textContent = select.children[index].textContent;
		createDiv.addEventListener('click', clickSelect);
		let createUl = document.createElement('ul');
		createUl.classList.add('select-ul');
		for (const item of select.children) {
			let createLi = document.createElement('li');
			createLi.classList.add('select-li');
			createLi.textContent = item.textContent;
			createLi.dataset.value = item.value;
			createUl.append(createLi);
		}
		createDiv.append(createUl);
		objectSelects.arrayCreateSelect.push(createDiv);
	}
	return objectSelects;
}

function addObjectSelectsInDOM(objectSelects) {
	for (let i = 0; i < objectSelects.arrayCreateSelect.length; i++) {
		if (objectSelects.parent[i]) {
			if (objectSelects.prep[i]) {
					objectSelects.prep[i].after(objectSelects.arrayCreateSelect[i]);
			} else if (objectSelects.next[i]) {
					objectSelects.next[i].before(objectSelects.arrayCreateSelect[i]);
			} else {
					objectSelects.parent[i].append(objectSelects.arrayCreateSelect[i]);
			}
		}
	}
}

addObjectSelectsInDOM(createObjectSelects());